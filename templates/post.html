{% extends "base.html" %}

{% block title %}Post Details{% endblock %}

{% block content %}
    <a href="{{ url_for('go_to_index') }}">
        <img class="back-button" alt="Back" src="../static/images/arrow2.svg" id="arrowIcon">
    </a>
    <div id="imageDetail">
        <div class="post-header">
            <div class="left-section">
                <a href="{{ url_for('profile', login=post.author.login) }}" class="author">
                    <span>@{{ post.author.login }}</span>
                </a>
            </div>
    
            <div class="right-section">
                {% if session.user and session.user.login == post.author_login %}
                    <form action="{{ url_for('delete_post') }}" method="POST" class="post-actions">
                        <input type="hidden" name="post_id" value="{{ post.id }}">
                        <button type="submit" class="delete-button">
                            <i class="fas fa-trash"></i> delete post
                        </button>
                    </form>
    
                    <a href="{{ url_for('edit_post', post_id=post.id) }}" class="edit-button">
                        <i class="fas fa-edit"></i> edit post
                    </a>
                {% endif %}
            </div>
        </div>
    
        <img alt="Image {{ post.id }}" src="{{ url_for('image', id=post.id) }}" id="selectedImage" data-id="{{ post.id }}">
        
        <div id="imageStats">
            <form action="{{ url_for('like_post') }}" method="POST">
                <input type="hidden" name="post_id" value="{{ post.id }}">
                <button type="submit" class="like-button">
                    <i class="fa fa-heart"></i>
                    <span>{{ post.like_count() }}</span>
                </button>
            </form>
            
            <span id="retweetsCount">
              <button type="button" class="retweet-button" onclick="toggleSharePopup()">
                  <i class="fa fa-retweet"></i>
                  <span>{{ post.shares_count() }}</span>
              </button>
          </span>
            <!-- Share Post Popup Modal -->
            <div id="sharePopupModal" class="popup-modal" style="display: none;">
                <div class="popup-content">
                    <div class="popup-header">
                        <span class="close-popup" onclick="toggleSharePopup()">Ã—</span>
                        <h2 class="popup-title">Share</h2>
                    </div>
                  
                  <!-- Input field for entering user names to share with -->
                  <form id="shareForm" action="{{ url_for('share_post')}}" method="POST">
                      <input type="hidden" name="post_id" value="{{ post.id }}">
                      <textarea id="shareNames" placeholder="Enter user login" name="recipient_login" rows="3" cols="50"></textarea>
                      <button type="submit" class="send-button">Send</button>
                  </form>
                </div>
            </div>
            <span id="commentsCount">
                <i class="fa fa-comment"></i> {{ post.comments_count() }}
            </span>
        </div>

        <div id="imageTags">
            <span id="tagsList">Tags:</span>
            {% for tag in post.associated_tags %}
                <span class="tag">#{{ tag.name }}</span>
            {% endfor %}
        </div>

        <div id="imageDescription">
            <h3>Description:</h3>
            <p>{{ post.text }}</p>
        </div>

        <!-- Comment Section -->
        <div id="commentSection">
            <h3>Comments:</h3>
            <form id="commentForm" action="{{ url_for('add_comment', post_id=post.id) }}" method="POST">
                <textarea id="commentInput" placeholder="Write a comment..." rows="3" cols="50" name="text" required></textarea>
                <button id="submitComment">Submit</button>
            </form>
            <div id="commentsList">
                {% for comment in comments %}
                    <div class="comment" style="border-bottom: 1px solid #ccc; padding: 10px;">
                        <div style="font-weight: bold; color: #555;">
                            <a href="{{ url_for('profile', login=comment.author.login) }}">
                                @{{ comment.author.login }} - <small>{{ comment.date.strftime('%Y-%m-%d %H:%M') }}</small>
                            </a>

                            {% if session.user and session.user.login == comment.author.login %}
                                <form action="{{ url_for('delete_comment') }}" method="POST" style="display: inline;">
                                    <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                    <button type="submit" style="background: none; border: none; color: red; font-size: 12px;">delete</button>
                                </form>
                            {% endif %}
                        </div>
                        <div style="margin-top: 5px;">
                            {{ comment.text }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        
    </div>
{% endblock %}
